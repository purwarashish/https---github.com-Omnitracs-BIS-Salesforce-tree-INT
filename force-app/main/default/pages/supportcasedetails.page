<apex:page id="thePage" cache="true" controller="MainController" action="{!csm_initSingleton}"
    sidebar="false"
    showHeader="false" title="{!CachedCase.Subject}">
    <apex:variable var="msg" value="{!$CurrentPage.parameters.action == 'CaseSubmitted'}"/>
 
    <script>
        var pagename="CaseReview";
    </script>
   <apex:include id="mainpage" pageName="mainPage" />
   

   
    <apex:form id="theForm">
        <!-- QESUnityCSSAndJS -->
        <style>
    .thankYouMsg
    {
        background-color: #EFEEEC;
        border: 1px solid #E1E1E0;
        color: #4E4548;
        font-size: 12px;
        font-weight:bold;
        padding: 10px 5px;
    }
    


  .subMenuList li a:visited
  {
   color: #315BA7 !important;
  }
  #testanchor
  {
      color : white !important;
  }

  #valueselect
  {
      background:url("../images/customer/subNavSprites.png") no-repeat 0 -93px;
  }

  ul.subMenuList span
  {
  display:block;
  }

*:first-child+html .suggestSoluctionBlock li a {
    display: block !important;
    padding-bottom: 3px;
}

*:first-child+html .suggestSoluctionBlock li {
    padding-bottom: 3px !important;
}
</style>
        <!-- link
            href="{!URLFOR($Resource.QESUnityCSSAndJS , 'Html/css/mainstyle.css')}"
            rel="stylesheet" type="text/css" />
        <link
            href="{!URLFOR($Resource.QESUnityCSSAndJS , 'Html/css/jquery.jcarousel.css')}"
            rel="stylesheet" type="text/css" />
        <link
            href="{!URLFOR($Resource.QESUnityCSSAndJS , 'Html/css/customer.css')}"
            rel="stylesheet" type="text/css" />
        <link rel="stylesheet"
            href="{!URLFOR($Resource.QESUnityCSSAndJS , 'Html/css/style.css')}"
            type="text/css" media="screen, projection" />
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery-1.4.2.min.js')}"
            type="text/javascript"></script>

        <script type="text/javascript" src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/checked.js')}">
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery.tinycarousel.min.js')}"
            type="text/javascript"></script>
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/menu.js')}"
            type="text/javascript"></script>
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery.bxSlider.min3.js')}"
            type="text/javascript"></script>

        
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery.dropdownPlain.js')}"
            type="text/javascript"></script>
        
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery.dropdownPlain2.js')}"
            type="text/javascript"></script>
       
        <script src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/text/javascript/scripts/combobox3.js')}"></script -->
        
        <script
            src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/scripts/jquery.pngFix.js')}"
            type="text/javascript"></script>

		<script type="text/javascript">
			window.onload = function() {
			    var links = document.getElementsByTagName('a');
				for(var i=0; i<links.length; i++) {
				  if(links[i].href == 'http://customer.int.omnitracs.com/'){
				  	links[i].href = 'https://login.int.omnitracs.com/go.jsp?d=home';
				  }
				  else if(links[i].href == 'http://customer.omnitracs.com/'){
				  	links[i].href = 'https://login.omnitracs.com/go.jsp?d=home';
				  }
				}
			};
		</script>
        <div id="bodyWrapper">
        
            <!-- End header -->


            <div class="breadcumWrp">
            <ul>
            <li>
                <a href="https://login.{!$Label.CPURL}go.jsp?d=home" >Home</a><span>|</span>
                <a class="breadcumlink" href="/apex/support">Support</a><span>|</span>
                Case
            </li>
            </ul>
            <h1 style="display: normal">Case</h1>
            <hr width="910px" align="center" style="height:1px;border:1px;color:#dadce0;background-color:#dadce0;" />
            </div>
            <div id="middle-container">
                <div  style=" {!if(msg,'display:normal','display:none')}" class="thankYouMsg BoxBottomSpace"> 
                <!-- modified as part of CP Rebranding -->
                    <apex:outputtext rendered="{!$CurrentPage.parameters.action == 'CaseSubmitted'}">Thank you for contacting Technical Support.  A Technical Support Specialist will respond to your request within 2 hours.<br/>For future reference, your Case number is <u>{!cachedCaseNumber}</u></apex:outputText>
                </div>
                <div class="custom-search-left fll">
                    <!--<div class="submitAcase">
                        <a href="">Browse Product Support</a>
                    </div>-->

                    <div class="">
                        <h3 class="suggestKnowledgeHeader"
                            style="display: block; font-size: 13px;">Suggested Answers</h3>
                        <div class="filterSearchBox">
                            <!-- TODO: After the suggested solutions is implemented, -->
                            <!-- change the following. -->

                            <ul class="subMenuList">
                                <apex:variable var="anyDocument" value="false" />
                                <apex:repeat id="articlelist" value="{!csm.suggestedSolutionsList}" var="article">
                                    <li style="margin-left: 0;">
                                       <a target="_blank" style="searchTitle" class="searchTitle" href="{!article.linkURL}">     
                                           <apex:outputtext >{!article.title}</apex:outputtext>
                                       </a>
                                    </li>
                                    <apex:variable var="anyDocument" value="true" />
                                </apex:repeat>
                            
                                <apex:outputText rendered="{!((anyDocument=='false') || ('' == CachedCase.Subject))}">                                
                                    <center style="padding:10px;">No Suggested Answers found.</center> 
                                </apex:outputText>
                            </ul>

                        </div>
                        <!-- End filterSearchBox -->
                    </div>
                    <apex:commandLink styleClass="hiddenCommandLinkCaseReview" action="{!csm.redirectToCaseDetail}"/>
                    <div class="recentCasesBoxTopMargin">
                        <h3 class="suggestKnowledgeHeader"
                            style="display: block; font-size: 13px;">Recent Cases</h3>
                        <h3></h3>
                        <div class="filterSearchBox">
                            <!-- TODO: After the recent cases is implemented, -->
                            <!-- change the following. -->
                            <ul class="subMenuList">
                                <apex:outputText rendered="{!(0 < csm.RecentCase.size)}">
                                    <apex:repeat id="list" value="{!csm.recentCase}" var="rfield">
                                        <li id="listvalue" style="margin-left: 0;">
                                            <a id="{!rfield.Id}" class="{!rfield.CaseNumber}" href="/apex/supportcasedetails?id={!rfield.Id}">
                                             <apex:outputtext value="{!rfield.Subject}"> </apex:outputtext>
                                             </a>
                                              <script>
                                                $(".{!rfield.Id}").click(
                                                    function(e) {
                                                        
                                                        e.preventDefault();
                                                        e.stopPropagation();
                                                        $("#thePage\\:theForm\\:hiddenInputField").val("{!rfield.Id}");
                                                        $(".hiddenCommandLinkCaseReview").click();
                                                    }
                                                );
                                             </script>
                                        </li>
                                    </apex:repeat>
                                </apex:outputText>
                                <apex:outputText rendered="{!(0 >= csm.RecentCase.size)}">
                                    <center style="padding:10px;">No Recent Cases found.</center> 
                                </apex:outputText>                                                            
                            </ul>
                        </div>
                    </div>
                    <!-- End recentCasesBoxTopMargin -->
                </div>
                <!-- End custom-search-left fll -->
                <!-- <apex:commandLink action="{!redirectFunc}" value="Go To List" oncontextmenu="return false;"/> -->

                <div class="custom-search-right fll">
                    <div style="width: 675px;">
                        <div class="caseListViewTitle">
                            <div class="searchTxtArea fll">Case View</div>
                            <div class="searchResultCount flr"></div>
                        </div>
                        <div class="caseViewForm">
                            <div class="fieldBox">

                                <div>
                                 <!-- a class="goToListButton flr" href="#" oncontextmenu="return false;" onclick="redirecttocases();"> Go To List</a -->
                                 <apex:commandLink action="{!csm.redirectToCases}" styleClass="goToListButton flr" value="Go To List of Cases"/>
                                 <!-- apex:actionfunction name="redirectToCases" action="{!csm.redirectToCases}"/ -->
                                </div>
                                <h5 class="formTextHeading">Contact Details</h5>
                                <div class=" caseSubDataWidth fll">
                                    <span class="">Name</span> <br /> <span class="bold"><apex:outPutText styleClass="" value="{!$User.FirstName} {!$User.LastName}"></apex:outPutText>
                                    </span>
                                </div>
                                <div class=" caseSubDataWidth fll">
                                    <span class="">Email</span> <br /> <span class="bold"><apex:outPutText styleClass="" value="{!$User.Email}"></apex:outPutText> </span>
                                </div>
                                <div class=" caseSubDataWidth fll">
                                    <span class="">Phone</span> <br /> <span class="bold"><apex:outPutfield styleClass="" value="{!CachedCase.QES_Unity_CP_Phone__c}"></apex:outPutfield> </span>
                                </div>
                                <div class=" caseSubDataWidth">
                                    <span class="">Preferred Contact Method</span> <br />
                                    <div class="chkBoxAlign fll">
                                        <span> <apex:outputField styleClass="styled"
                                                value="{!csm.tempCase.PCMPhone__c}" /> </span> <span class="bold">Phone</span>
                                    </div>
                                    <div class="chkBoxAlign fll">
                                        <span class=""> <apex:outputField styleClass="styled"
                                                value="{!csm.tempCase.PCMEmail__c}" /> </span> <span class="bold">Email</span>
                                    </div>
                                </div>
                                <div class="clr">
                                    <img border="0" width="1" height="1" alt=""
                                        src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/images/customer/spacer.png')}"/>
                                </div>
                                <h5 class="formTextHeading clr"
                                    style="margin-top: 20px; display: block;">Case Details</h5>
                                <div>

                                    <!-- Contract_Product__c -->

                                    <div class="textMarginTop">
                                        <span class="caseDetails">Case Number</span> <span
                                            class="caseDetailAlign"> <apex:outputText styleclass=""
                                                value="{!cachedCaseNumber}" /> </span>
                                    </div>
                                    
                                    <div class="textMarginTop">
                                        <span class="caseDetails">Platform </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2"
                                                value="{!CachedCase.Platform__c}" /> </span>
                                    </div>
                                    <div class="textMarginTop">
                                        <span class="caseDetails">Application </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Application__c}" /> </span>
                                    </div>
                                    
                                    <div class="textMarginTop">
                                        <span class="caseDetails">Status</span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2"
                                                value="{!CachedCase.Status}" /> </span>
                                    </div>


                                    <!-- Commented as per requirements in Sprint1
                                <div class="textMarginTop">
                                    <span class="caseDetails">Status :</span>
                                    <span class="caseDetailAlign">
                                        <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Status}" />
                                    </span>
                                </div>
                                Commented code ends -->


                                    <div class="textMarginTop">
                                        <span class="caseDetails">Serial Number or Unit Address </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Serial__c}" /> </span>
                                    </div>
                                    <div class="textMarginTop">
                                        <span class="caseDetails">Subject </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Subject}" /> </span>
                                    </div>
                                    <div class="textMarginTop">
                                        <span class="caseDetails txtValign">Description </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Description}" />
                                        </span>
                                    </div>
                                    <div class="textMarginTop">
                                        <span class="caseDetails txtValign">Solution </span> <span
                                            class="caseDetailAlign"> <apex:outputField styleclass="caseViewTxtBox2" value="{!CachedCase.Resolution__c}" />
                                        </span>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End custom-search-right flr -->

                <div class="clr">
                    <img width="1" height="1" border="0" alt=""
                        src="{!URLFOR($Resource.QESUnityCSSAndJS, 'Html/images/customer/spacer.png')}" />
                </div>
            </div>
            <!-- End middle-container -->

            <apex:include pageName="UnityFooter" />
            
            <!-- End footer -->
        </div>

        <!-- Added by ALWIN on Jun 16 -->
        <script>
        
        $('a.searchTitle').click(
        function(e)
        {
          e.preventDefault();
          e.stopPropagation();
          var URL = $(this).attr('href');
          window.open(URL,'', 'height=550,width=1024,location=no,resizable=yes,toolbar=no,status=no,menubar=no,scrollbars=yes');
        });
        
            $(document)
                    .ready(
                            function() {
                                    var currURL=window.location.href;
                                    
                                    var linkId=currURL.substring(currURL.lastIndexOf('id')+3);
                                    
                                    
                                    var name = '';
                                    $("#" + linkId).parent().toggleClass("select");
                                    $("#" + linkId).attr("id","testanchor");

                                // first locate all of the select tags on the page and hide them
                                $("select.changeMe").css('display', 'none');
                                //now, for each select box, run this function
                                /* $("select.changeMe")
                                     .each(
                                             function() {


                                                 var curSel = $(this);
                                                 // get the CSS width from the original select box
                                                 var gddWidth = $(curSel)
                                                         .css('width');
                                                 var gddWidthL = gddWidth
                                                         .slice(0, -2);
                                                 var gddWidth2 = gddWidthL - 28;
                                                 var gddWidth3 = gddWidthL - 16;
                                                 // build the new div structure
                                                 var gddTop = '<div style="width:' + gddWidthL + 'px" class="selectME3" tabindex="0"><div class="cornerstop"><div><div></div></div></div><div class="middle"><div><div><div>';
                                                 //get the default selected option
                                                 var whatSelected = $(curSel)
                                                         .children(
                                                                 'option:selected')
                                                         .text();
                                                 //write the default
                                                 var gddFirst = '<div class="first"><span class="selectME3 gselected" style="width:'+ gddWidth2 +  'px;">'
                                                         + whatSelected
                                                         + '</span><span id="arrowImg3"></span><div class="clears"></div></div><ul class="selectME3">';
                                                 // create a new array of div options from the original's options
                                                 var addItems = new Array();
                                                 $(curSel)
                                                         .children('option')
                                                         .each(
                                                                 function() {
                                                                     var text = $(
                                                                             this)
                                                                             .text();
                                                                     var selVal = $(
                                                                             this)
                                                                             .attr(
                                                                                     'value');
                                                                     var before = '<li style="width:' + gddWidthL + 'px;"><a href="#" rel="' + selVal + '" tabindex="0"  style="width:' + gddWidth3 + 'px;">';
                                                                     var after = '</a></li>';
                                                                     addItems
                                                                             .push(before
                                                                                     + text
                                                                                     + after);
                                                                 });
                                                 //hide the default from the list of options
                                                 var removeFirst = addItems
                                                         .shift();
                                                 // create the end of the div selectbox and close everything off
                                                 var gddBottom = '</ul></div></div></div></div><div class="cornersbottom"><div><div></div></div></div></div>'
                                                 //write everything after each selectbox
                                                 var GDD = gddTop + gddFirst
                                                         + addItems.join('')
                                                         + gddBottom;
                                                 $(curSel).after(GDD);
                                                 //this var selects the div select box directly after each of the origials
                                                 var nGDD = $(curSel).next(
                                                         'div.selectME3');

                                                 $(nGDD).find('li:first')
                                                         .addClass("first");

                                                 $(nGDD).find('li:last')
                                                         .addClass('last');
                                                 //handle the on click functions - push results back to old text box
                                            $(nGDD)
                                                    .click(
                                                            function(e) {
                                                                var myTarA = $(
                                                                        e.target)
                                                                        .attr(
                                                                                'rel');
                                                                var myTarT = $(
                                                                        e.target)
                                                                        .text();
                                                                var myTar = $(e.target);
                                                                //if closed, then open
                                                                if ($(
                                                                        nGDD)
                                                                        .find(
                                                                                'li')
                                                                        .css(
                                                                                'display') == 'none') {
                                                                    //this next line closes any other selectboxes that might be open
                                                                    $(
                                                                            'div.selectME3')
                                                                            .find(
                                                                                    'li')
                                                                            .css(
                                                                                    'display',
                                                                                    'none');
                                                                    $(
                                                                            nGDD)
                                                                            .find(
                                                                                    'li')
                                                                            .css(
                                                                                    'display',
                                                                                    'block');

                                                                    //if user clicks off of the div select box, then shut the whole thing down
                                                                    $(
                                                                            document.window
                                                                                    || 'body')
                                                                            .click(
                                                                                    function(
                                                                                            f) {
                                                                                        var myTar2 = $(f.target);
                                                                                        if (myTar2 !== nGDD) {
                                                                                            $(
                                                                                                    nGDD)
                                                                                                    .find(
                                                                                                            'li')
                                                                                                    .css(
                                                                                                            'display',
                                                                                                            'none');
                                                                                        }
                                                                                    });
                                                                    return false;
                                                                } else {
                                                                    if (myTarA == null) {
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'li')
                                                                                .css(
                                                                                        'display',
                                                                                        'none');
                                                                        return false;
                                                                    } else {
                                                                        //set the value of the old select box
                                                                        $(
                                                                                curSel)
                                                                                .val(
                                                                                        myTarA);
                                                                        //set the text of the new one
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'span.gselected')
                                                                                .text(
                                                                                        myTarT);
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'li')
                                                                                .css(
                                                                                        'display',
                                                                                        'none');
                                                                        return false;
                                                                    }
                                                                }
                                                                //handle the tab index functions
                                                            })
                                                    .focus(
                                                            function(e) {

                                                                $(nGDD)
                                                                        .find(
                                                                                'li:first')
                                                                        .addClass(
                                                                                'currentDD');
                                                                $(nGDD)
                                                                        .find(
                                                                                'li:last')
                                                                        .addClass(
                                                                                'lastDD');
                                                                function checkKey(
                                                                        e) {
                                                                    //on keypress handle functions
                                                                    function moveDown() {
                                                                        var current = $(
                                                                                nGDD)
                                                                                .find(
                                                                                        '.currentDD:first');
                                                                        var next = $(
                                                                                nGDD)
                                                                                .find(
                                                                                        '.currentDD')
                                                                                .next();
                                                                        if ($(
                                                                                current)
                                                                                .is(
                                                                                        '.lastDD')) {
                                                                            return false;
                                                                        } else {
                                                                            $(
                                                                                    next)
                                                                                    .addClass(
                                                                                            'currentDD');
                                                                            $(
                                                                                    current)
                                                                                    .removeClass(
                                                                                            'currentDD');
                                                                        }
                                                                    }
                                                                    function moveUp() {
                                                                        var current = $(
                                                                                nGDD)
                                                                                .find(
                                                                                        '.currentDD:first');
                                                                        var prev = $(
                                                                                nGDD)
                                                                                .find(
                                                                                        '.currentDD')
                                                                                .prev();
                                                                        if ($(
                                                                                current)
                                                                                .is(
                                                                                        '.first')) {
                                                                            return false;
                                                                        } else {
                                                                            $(
                                                                                    prev)
                                                                                    .addClass(
                                                                                            'currentDD');
                                                                            $(
                                                                                    current)
                                                                                    .removeClass(
                                                                                            'currentDD');
                                                                        }
                                                                    }
                                                                    var curText = $(
                                                                            nGDD)
                                                                            .find(
                                                                                    '.currentDD:first')
                                                                            .text();
                                                                    var curVal = $(
                                                                            nGDD)
                                                                            .find(
                                                                                    '.currentDD:first a')
                                                                            .attr(
                                                                                    'rel');
                                                                    switch (e.keyCode) {
                                                                    case 40:
                                                                        $(
                                                                                curSel)
                                                                                .val(
                                                                                        curVal);
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'span.gselected')
                                                                                .text(
                                                                                        curText);
                                                                        moveDown();
                                                                        return false;
                                                                        break;
                                                                    case 38:
                                                                        $(
                                                                                curSel)
                                                                                .val(
                                                                                        curVal);
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'span.gselected')
                                                                                .text(
                                                                                        curText);
                                                                        moveUp();
                                                                        return false;
                                                                        break;
                                                                    case 13:
                                                                        $(
                                                                                nGDD)
                                                                                .find(
                                                                                        'li')
                                                                                .css(
                                                                                        'display',
                                                                                        'none');
                                                                    }
                                                                }
                                                                $(
                                                                        document)
                                                                        .keydown(
                                                                                checkKey);
                                                            })
                                                    .blur(
                                                            function() {
                                                                $(
                                                                        document)
                                                                        .unbind(
                                                                                'keydown');
                                                            });
                                        }); */
                    });
       $('a.artlink').click(
            function(e)
            {
               redir1($(this).attr('href'),e);
            }
        );

        function redir1(rUrl,e)
        {
            e.preventDefault();
            e.stopPropagation();
         
            $("#thePage\\:theForm\\:hiddenInputField").val(rUrl); 
            $("a.hiddencmdlink").click();
            
            return false;
        }
          $('a.breadcumlink').click(
            function(e)
            {
               
               redir($(this).attr('href'),e);
            }
        );

        function redir(rUrl,e)
        {
            e.preventDefault();
            e.stopPropagation();

            $("#thePage\\:theForm\\:hiddenInputField").val(rUrl);
            $("a.hiddencmdlink1").click();
            return false;
        }
        </script>
        <apex:commandLink id="hiddencmdlink"  target="_blank" styleclass="hiddencmdlink" value="" action="{!csm.redirectToArticles}" />
        <apex:commandLink id="hiddencmdlink1"  styleclass="hiddencmdlink1" value="" action="{!csm.redirectToArticles}" />
        <apex:inputHidden id="hiddenInputField" value="{!csm.hiddenInputField}"/>
    </apex:form>

</apex:page>